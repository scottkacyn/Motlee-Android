package com.motlee.android.view;

import java.util.ArrayList;

import android.app.Activity;
import android.content.Context;
import android.support.v4.app.FragmentActivity;
import android.util.AttributeSet;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.MotionEvent;
import android.view.VelocityTracker;
import android.view.View;
import android.view.ViewGroup;
import android.view.View.MeasureSpec;
import android.widget.AbsListView;
import android.widget.FrameLayout;
import android.widget.ImageView;
import android.widget.AbsListView.OnScrollListener;
import android.widget.AdapterView;
import android.widget.LinearLayout;
import android.widget.ListAdapter;
import android.widget.ListView;
import android.widget.SlidingDrawer;

import com.devsmart.android.ui.HorizontalListView;
import com.motlee.android.R;
import com.motlee.android.adapter.HeaderViewListAdapter;
import com.motlee.android.adapter.ImageAdapter;
import com.motlee.android.object.FixedViewInfo;
import com.motlee.android.object.GlobalActivityFunctions;
import com.motlee.android.object.GlobalVariables;
import com.motlee.android.object.MenuFunctions;
import com.motlee.android.object.PhotoItem;

public class HorizontalListViewDisallowIntercept extends HorizontalListView implements android.widget.AdapterView.OnItemClickListener {

	private VelocityTracker mVelocityTracker;
	
	private int startX = 0;
	private int startY = 0;
	private int endX = 0;
	private int endY = 0;
	
	private boolean mIsAttending;
	private int mEventId;
	
	private ArrayList<FixedViewInfo> mHeaderViewInfos = new ArrayList<FixedViewInfo>();
	
	private FrameLayout mPullOutDrawer;
	private ImageView mPullOutIcon;
	private LayoutInflater mInflater;
	
	private int mOffset;
	
	private Panel mSlidingDrawer;
	
	public HorizontalListViewDisallowIntercept(Context context,
			AttributeSet attrs) {
		super(context, attrs);
		
		setOnItemClickListener(this);
		
		//init(context);
	}
	
	public void setSlidingDrawer(Panel drawer)
	{
		mSlidingDrawer = drawer;
	}
	
	private void init(Context context) {
		
		mInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
		
		mPullOutDrawer = (FrameLayout) mInflater.inflate(R.layout.event_list_pull_out_drawer, null);
		
		//mPullOutDrawer.setBackgroundResource(R.drawable.event_list_slide_out_full);
		
		if (mIsAttending)
		{
			mPullOutDrawer.findViewById(R.id.pull_out_drawer_camera).setVisibility(View.VISIBLE);
			mPullOutDrawer.findViewById(R.id.pull_out_drawer_eye_ball).setVisibility(View.GONE);
		}
		else
		{
			mPullOutDrawer.findViewById(R.id.pull_out_drawer_camera).setVisibility(View.GONE);
			mPullOutDrawer.findViewById(R.id.pull_out_drawer_eye_ball).setVisibility(View.VISIBLE);
		}
		
		//addHeaderView(mPullOutDrawer);
		
		/*int imageHeight = GlobalVariables.getInstance().getMaxEventListImageHeight();
		
		float scale = imageHeight / 123.0f;
		
		int imageWidth = (int) scale * 186;
		
		mOffset = (-1) * imageWidth;
		
		mDisplayOffset = (-1) * imageWidth;*/
	}

	private void addHeaderView(View view) {
		
		FixedViewInfo info = new FixedViewInfo();  
		info.view = view;
		info.data = null;
		info.isSelectable = false;
		
		mHeaderViewInfos.add(info);
		
	}

	public void setIsAttending(boolean isAttending)
	{
		mIsAttending = isAttending;
	}

	public void setEventId(int eventId)
	{
		mEventId = eventId;
	}
	
	@Override
	public boolean dispatchTouchEvent(MotionEvent event)
	{
		boolean ret = super.dispatchTouchEvent(event);
		if (ret)
		{
            switch (event.getAction()) { 
            	case MotionEvent.ACTION_DOWN: 
		           startX = (int)event.getX(); 
		           startY = (int)event.getY(); 
		           return ret; 
            	case MotionEvent.ACTION_MOVE: 
		           endX = (int)event.getX(); 
		           endY = (int)event.getY(); 
           
		           if (Math.abs(endX - startX) > Math.abs(endY - startY)) 
		           { 
		        	   requestDisallowInterceptTouchEvent(true);
		        	   /*if (startX > endX)
		        	   {
		        		   mSlidingDrawer.setOpen(false, false);
		        	   }
		        	   else if (endX > startX)
		        	   {
		        		   mSlidingDrawer.setOpen(true, false);
		        	   }*/
		           } 
           
		           startX = (int)event.getX(); 
		           startY = (int)event.getY(); 
		
		           return ret; 
            	case MotionEvent.ACTION_UP: 
		           endX = (int)event.getX(); 
		           endY = (int)event.getY(); 
		           return ret; 
            } 
			
		}
		return ret;
	}

	public void onItemClick(AdapterView<?> parent, View view, int position, long id) {

		PhotoItem photo = (PhotoItem) getItemAtPosition(position);
		
		if (photo == ImageAdapter.NO_PHOTO)
		{
			if (mIsAttending)
			{
				if (getContext() instanceof FragmentActivity)
				{
					MenuFunctions.takePictureOnPhone(mEventId, (FragmentActivity) getContext());
				}
			}
		}
		else
		{
			if (getContext() instanceof Activity)
			{
				GlobalActivityFunctions.showPictureDetail(photo, (Activity) getContext(), true);
			}
		}
	}		
	
}
